{{ define "body-class" }}
    article-page
    {{/* 
        Enable the right sidebar if
            - Widget different from 'TOC' is enabled
            - TOC is enabled and not empty
    */}}
    {{- $HasWidgetNotTOC := false -}}
    {{- $TOCWidgetEnabled := false -}}
    {{- range .Site.Params.widgets.page -}}
        {{- if ne .type "toc" -}}
            {{ $HasWidgetNotTOC = true -}}
        {{- else -}}
            {{ $TOCWidgetEnabled = true -}}
        {{- end -}}
    {{- end -}}

    {{- $TOCManuallyDisabled := eq .Params.toc false -}}
    {{- $TOCEnabled := and (not $TOCManuallyDisabled) $TOCWidgetEnabled -}}
    {{- $hasTOC := ge (len .TableOfContents) 100 -}}
    {{- .Scratch.Set "TOCEnabled" (and $TOCEnabled $hasTOC) -}}
    
    {{- .Scratch.Set "hasWidget" (or $HasWidgetNotTOC (and $TOCEnabled $hasTOC)) -}}
{{ end }}

{{ define "main" }}
    {{ partial "article/article.html" . }}

    {{ if .Params.links }}
        {{ partial "article/components/links" . }}
    {{ end }}

    {{ partial "article/components/related-content" . }}
     
    {{ if not (eq .Params.comments false) }}
        {{ partial "comments/include" . }}
    {{ end }}

    {{ partialCached "footer/footer" . }}

    {{ partialCached "article/components/photoswipe" . }}

    <style>
        /* 设置按钮样式 */
        #clapButton {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background-color: #fff;
            border: none;
            padding: 10px 20px;
            font-size: 15px;
            border-radius: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            z-index: 999; /* 确保按钮在最前面 */
        }
    
        /* 设置点赞数字样式 */
        #clapCount {
            font-weight: bold;
            color: #34495E;
        }
    
        /* 设置emoji漂浮效果 */
        .clap-emoji {
            position: absolute;
            font-size: 25px;
            color: #f8b8d1;
            animation: floatUp 1s ease-out forwards;
            z-index: 1000; /* 确保emoji在按钮前面 */
        }
    
        /* 控制emoji漂浮和变浅的动画 */
        @keyframes floatUp {
            0% {
                transform: translateY(0);
                opacity: 1;
            }
            50% {
                transform: translateY(-30px);
                opacity: 0.7;
            }
            100% {
                transform: translateY(-60px);
                opacity: 0;
            }
        }
    </style>
    
    <!-- Clap Button -->
    <button id="clapButton">
        👏 <span id="clapCount">0</span>
    </button>
    
    <script>
        let claps = localStorage.getItem('claps') || 0;
        document.getElementById("clapCount").innerText = claps;
    
        document.getElementById("clapButton").addEventListener("click", function() {
            claps++;
            localStorage.setItem('claps', claps);
            document.getElementById("clapCount").innerText = claps;
    
            // 添加点击按钮的样式效果
            this.style.backgroundColor = "#f7b200"; // 背景色变为粉色
            this.style.transform = "scale(1.1)"; // 按钮稍微放大
    
            // 获取按钮的位置
            const buttonRect = this.getBoundingClientRect();
            
            // 添加 emoji 动画效果
            let emoji = document.createElement("span");
            emoji.classList.add("clap-emoji");
            emoji.innerText = "👏";
            
            // 设置emoji的位置，确保它出现在按钮上方
            emoji.style.left = `${buttonRect.left + buttonRect.width / 2 - 15}px`; // 水平居中对齐
            emoji.style.top = `${buttonRect.top - 30}px`; // 在按钮上方30px位置开始
    
            // 将 emoji 添加到页面
            document.body.appendChild(emoji);
    
            // 在动画结束后移除 emoji 元素
            setTimeout(() => {
                emoji.remove();
            }, 1000); // 动画时间需要与动画时长一致
    
            // 重置按钮样式
            setTimeout(() => {
                this.style.backgroundColor = "#fff";
                this.style.transform = "scale(1)";
            }, 300);
        });
    </script>    
{{ end }}

{{ define "right-sidebar" }}
    {{ if .Scratch.Get "hasWidget" }}{{ partial "sidebar/right.html" (dict "Context" . "Scope" "page") }}{{ end}}
{{ end }}



